# Configuration Matrix Synapse pour Mission D.I.P.
# Réseau fermé - Chiffrement E2E - Autonome

# === SERVEUR ===
server_name: "dip.local"
pid_file: /data/homeserver.pid
web_client_location: https://dip.local/element/
public_baseurl: https://dip.local
report_stats: false

# === ÉCOUTE ===
listeners:
  - port: 8008
    tls: false
    type: http
    x_forwarded: true
    bind_addresses: ['0.0.0.0']
    resources:
      - names: [client, federation]
        compress: false

# === BASE DE DONNÉES ===
database:
  name: psycopg2
  args:
    user: synapse
    password: M9jdEm86
    database: synapse
    host: postgres
    port: 5432
    cp_min: 5
    cp_max: 10

# === LOGGING ===
log_config: "/data/log.config"

# === MÉDIAS ET STOCKAGE ===
media_store_path: /data/media_store
uploads_path: /data/uploads
max_upload_size: 50M
max_image_pixels: 32M

# === UTILISATEURS ET INSCRIPTION ===
enable_registration: false
registration_shared_secret: "${REGISTRATION_SECRET}"
allow_guest_access: false
default_room_version: "10"

# === SÉCURITÉ ===
# Désactiver la fédération (réseau fermé)
federation_domain_whitelist: []
send_federation: false

# Clés de signature
signing_key_path: "/data/homeserver.signing.key"
trusted_key_servers: []

# === CHIFFREMENT E2E ===
encryption_enabled_by_default_for_room_type: all
require_auth_for_profile_requests: true

# === LIMITES DE TAUX (Intranet) ===
rc_message:
  per_second: 10
  burst_count: 100

rc_registration:
  per_second: 0.5
  burst_count: 5

rc_login:
  address:
    per_second: 1
    burst_count: 5
  account:
    per_second: 1
    burst_count: 5

# === RÉTENTION ===
user_ips_max_age: 30d
redaction_retention_period: 7d

# === SALLES ===
allow_public_rooms_without_auth: true
allow_public_rooms_over_federation: false

# === ADMIN INITIAL ===
# Pour créer le premier utilisateur admin
auto_join_rooms:
  - "#general:dip.local"

# === MÉTRIQUES ===
enable_metrics: true
metrics_bind_host: 0.0.0.0
metrics_port: 9000

# === SÉCURITÉ SUPPLÉMENTAIRE ===
suppress_key_server_warning: true
enable_3pid_lookup: false